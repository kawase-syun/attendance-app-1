# 出退勤打刻アプリ

LINEグループに通知される出退勤打刻アプリです。スプレッドシートに記録を残し、勤務時間を自動計算します。

## 機能

- **出勤打刻**: ボタン一つで出勤を記録し、LINEグループに通知
- **退勤打刻**: 退勤を記録し、勤務時間を自動計算してLINEグループに通知
- **課題完了報告**: 課題完了をLINEで報告
- **勤務履歴**: Googleスプレッドシートに自動保存
- **PWA対応**: スマホのホーム画面に追加可能

## セットアップ手順

### 1. スプレッドシートの準備

1. 新しいGoogleスプレッドシートを作成
2. スプレッドシート名は任意（例: 「出退勤管理」）

### 2. Google Apps Scriptの設定

1. スプレッドシート上部: **拡張機能** → **Apps Script**
2. `Code.gs`ファイルの内容をコピー&ペースト
3. 保存（Ctrl + S）

### 3. LINE Notify トークンの取得

#### 3-1. LINE Notifyにアクセス
https://notify-bot.line.me/ にアクセスしてログイン

#### 3-2. グループLINEにLINE Notifyを招待
1. 通知を送りたいグループLINEを開く
2. 右上のメニュー → 「招待」
3. 検索で「LINE Notify」を探して招待

#### 3-3. トークンを発行
1. LINE Notifyのマイページで「トークンを発行する」をクリック
2. 設定:
   - **トークン名**: 「出退勤打刻アプリ」など
   - **通知を送信するトークルーム**: 作成したグループLINEを選択
3. 「発行する」をクリック
4. **表示されたトークンをコピー**（この画面は1回のみ表示）

#### 3-4. トークンをGASに設定
`Code.gs`の7行目を編集:
```javascript
LINE_NOTIFY_TOKEN: 'ここにコピーしたトークンを貼り付け',
```

### 4. ユーザー情報の設定

`Code.gs`の17行目以降でユーザーマッピングを編集:
```javascript
const USER_MAP = {
  'user01': '川瀬隼',
  'user02': '山田太郎',  // 追加するユーザー
  'user03': '佐藤花子',  // 追加するユーザー
};
```

### 5. GASのデプロイ

1. 右上「デプロイ」→「新しいデプロイ」
2. 歯車アイコン ⚙️ → 「ウェブアプリ」を選択
3. 設定:
   - **説明**: v1（任意）
   - **次のユーザーとして実行**: 自分
   - **アクセスできるユーザー**: **全員**（重要！）
4. 「デプロイ」をクリック
5. **ウェブアプリのURL**をコピー

### 6. アプリ側の設定

`app.js`の3行目にデプロイURLを設定:
```javascript
GAS_URL: 'ここにコピーしたウェブアプリURLを貼り付け',
```

各ユーザーのUSER_IDを設定（5行目）:
```javascript
USER_ID: 'user01'  // user02, user03など
```

### 7. テスト

#### GAS側のテスト
1. GASエディタで関数を選択: `testCheckIn`
2. 「実行」をクリック
3. 権限を承認
4. LINEグループに通知が届くか確認

#### アプリ側のテスト
1. `index.html`をブラウザで開く
2. 出勤ボタンをクリック
3. LINEグループに通知が届き、スプレッドシートに記録されることを確認

## ファイル構成

```
attendance-app/
├── index.html          # メインHTML
├── app.js             # フロントエンドJavaScript
├── style.css          # スタイルシート
├── manifest.json      # PWA設定
├── service-worker.js  # Service Worker
├── Code.gs            # Google Apps Scriptコード
├── icon-192.png       # アプリアイコン（192x192）
├── icon-512.png       # アプリアイコン（512x512）
└── README.md          # このファイル
```

## 使い方

### 出勤打刻
1. アプリを開く
2. 「出勤」ボタンをクリック
3. 確認ダイアログで「OK」
4. LINEグループに通知が届き、スプレッドシートに記録される

### 退勤打刻
1. アプリを開く
2. 「退勤」ボタンをクリック
3. 確認ダイアログで「OK」
4. 勤務時間が自動計算され、LINEグループに通知される

### 課題完了報告
1. アプリを開く
2. 「課題完了報告」ボタンをクリック
3. 確認ダイアログで「OK」
4. 管理者のLINEに通知が届く

## スプレッドシートの見方

自動生成される「出退勤記録」シートには以下の情報が記録されます:

| 日時 | 名前 | ユーザーID | 種別 | 退勤時刻 | 勤務時間 |
|------|------|------------|------|----------|----------|
| 2025/10/25 09:00:00 | 川瀬隼 | user01 | 出勤 | 2025/10/25 18:00:00 | 9時間0分 |

## トラブルシューティング

### CORSエラーが出る
- GASが正しくデプロイされているか確認
- 「アクセスできるユーザー: 全員」になっているか確認
- GASのURLが正しく設定されているか確認

### LINE通知が届かない
- LINE Notifyトークンが正しく設定されているか確認
- LINE NotifyがグループLINEに招待されているか確認
- GASエディタのログで`Logger.log`を確認

### 勤務時間が計算されない
- 出勤打刻が正しく記録されているか確認
- 同じユーザーIDで出勤・退勤を行っているか確認

## ライセンス

MIT License

## 作者

川瀬隼

---

Generated with Claude Code
